function ar(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();async function T(e){const t=await fetch(e);if(!t.ok)throw new Error("Failed to load ".concat(e));return await t.text()}const be="https://gfoh.ddns.net:6969/api";window.port=6969;async function se(e){var t,n,s;try{const o=await fetch("".concat(be).concat(e));if(!o.ok)throw new Error("❌❌❌❌Fehler beim Abrufen von ".concat(e,": ").concat(o.statusText));const r=await o.json();return console.log("✅✅✅✅ ERFOLGREICH GELADEN!"+e),r}catch(o){return console.error(o),(t=o==null?void 0:o.message)!=null&&t.includes("503")||(n=o==null?void 0:o.message)!=null&&n.includes("Failed to fetch")||(s=o==null?void 0:o.message)!=null&&s.includes("Service Unavailable")?(await new Promise(r=>setTimeout(r,1e3)),console.log("❌❌❌❌ Retrying fetch for "+e+" due to 503... ❌❌❌❌"),await se(e)):null}}async function C(e,t){var n,s,o;try{console.log("[fetchDataWithToken] ➜ Endpoint: ".concat(e,", Token:"),t);const r=await fetch("".concat(be).concat(e),{method:"GET",headers:{Authorization:"Bearer ".concat(t)}});if(console.log("[fetchDataWithToken] ⇐ Status: ".concat(r.status)),r.status===403)throw console.log("403"),new Error("Token abgelaufen oder ungültig (403 Forbidden)");if(!r.ok)throw console.log("other error"),new Error("Fehler beim Abrufen von ".concat(e,": ").concat(r.statusText));const i=await r.json();return console.log("[fetchDataWithToken] ✅ Erfolgreich geladen:",i),console.log("✅✅✅✅ ERFOLGREICH GELADEN!"+e),i}catch(r){return console.error(r),(n=r==null?void 0:r.message)!=null&&n.includes("503")||(s=r==null?void 0:r.message)!=null&&s.includes("Failed to fetch")||(o=r==null?void 0:r.message)!=null&&o.includes("Service Unavailable")?(await new Promise(i=>setTimeout(i,1e3)),console.log("❌❌❌❌ Retrying fetch for "+e+" due to 503... ❌❌❌❌"),await C(e,t)):null}}async function b(e,t,n){var s,o,r;try{console.log(t);const i=await fetch("".concat(be).concat(e),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)},body:JSON.stringify(t)});if(!i.ok)throw new Error("Fehler beim Senden von ".concat(e,": ").concat(i.statusText));const a=await i.json();return console.log("✅✅✅✅ ERFOLGREICH GELADEN!"+e),a}catch(i){return console.error(i),(s=i==null?void 0:i.message)!=null&&s.includes("503")||(o=i==null?void 0:i.message)!=null&&o.includes("Failed to fetch")||(r=i==null?void 0:i.message)!=null&&r.includes("Service Unavailable")?(await new Promise(a=>setTimeout(a,1e3)),console.log("❌❌❌❌ Retrying fetch for "+e+" due to 503... ❌❌❌❌"),console.log(t),await b(e,t,n)):null}}function jt(e){try{const t=e.split(".")[1],n=atob(t);return JSON.parse(n)}catch(t){return null}}function v(){const e=localStorage.getItem("token");if(!e)throw new Error("Token nicht gefunden");return e}function D(){const e=v();return jt(e)}function ze(){localStorage.removeItem("token"),localStorage.removeItem("userData"),alert("Your session has expired. You are being logged out."),window.location.href="./html-pages/unauthorized.html"}async function Wt(e){try{const t=D();(!t||!e.includes(t.role))&&Vt()}catch(t){console.warn("Access denied because no token was found. Redirecting..."),Gt()}}function Gt(){window.location.href="./set-up/pages/getstarted.html"}async function Vt(){const e=document.getElementsByTagName("body")[0];e.innerHTML="!! ACCESS DENIED !!",await new Promise(t=>setTimeout(t,1)),alert("No access to this page."),window.location.href="./html-pages/unauthorized.html"}function K(e){const t=D();if(t)return t.role===e}async function Me(){const e=localStorage.getItem("token");if(!e)return console.log("[checkSessionTokenValid] Kein Token gefunden"),!1;try{const t=await C("/check-token",e);return console.log("[checkSessionTokenValid] ✅ Token gültig"),!0}catch(t){return t.message.includes("403")?(console.warn("[checkSessionTokenValid] ❌ Token abgelaufen – Nutzer wird ausgeloggt"),ze(),!1):(console.warn("[checkSessionTokenValid] ⚠️ Server nicht erreichbar – Tokenstatus unbekannt, Nutzer bleibt eingeloggt"),!0)}}function Kt(e,t){t&&localStorage.setItem(e,JSON.stringify(t))}async function Ie(){return await se("/dishes")}async function zt(){return await se("/dish_ingredients")}async function Ye(){return await se("/ingredients")}async function Yt(){return await C("/users",v())}async function $e(e="all"){const t=v();return await b("/dishes_full_filtered",{category:e},t)}async function Jt(){const e=await Ie(),t=await Ye(),n=await zt(),s={dishes:e,ingredients:t,dishIngredients:n};return Kt("data",s),s}function Xt(){const e=localStorage.getItem("data");if(!e)return null;try{return JSON.parse(e)}catch(t){return console.error("Fehler beim Parsen der gespeicherten Daten:",t),null}}async function Zt(e){const n=(await C("/users",v())).find(s=>s.email===e);if(!n)throw new Error("Benutzer nicht gefunden");return n.user_id}async function Qt(e,t){try{const n=await Zt(t),s=v(),r=await b("/set-role",{userId:n,role:e},s);return alert("Rolle erfolgreich geändert!"),r}catch(n){alert("Fehler beim Rollenwechsel: "+n.message)}}async function en(e){try{const t=v();return await b("/delete-user",{userID:e},t)}catch(t){return alert("Failed to delete user: "+t.message),!1}}async function tn(e){try{const t=v();return await b("/add-dish",e,t)}catch(t){alert("Failed to add new dish: "+t.message)}}async function nn(e){try{const t=v();return await b("/add-ingredient",e,t)}catch(t){alert("Failed to add new ingredient: "+t.message)}}async function sn(e){try{const t=v();return await b("/delete-dish",{dishID:e},t)}catch(t){alert("Failed to delete dish: "+t.message)}}async function on(e){try{const t=v();return await b("/delete-ingredient",{ingredientID:e},t)}catch(t){alert("Failed to delete ingredient: "+t.message)}}function Je(e){const t=D();b("/add-week-plan",{weekPlan:e,userId:t.id},v())}async function rn(){const e=v();return await C("/get-week-plan",e)}async function an(){const e=v();return await C("/get-ingredients-from-week-plan",e)}function cn(){try{const e=localStorage.getItem("userData");return e?JSON.parse(e):{}}catch(e){return console.error("Error reading user data:",e),{}}}async function Xe(e){const t=v();if(!t||!e)throw new Error("Token or UserInfo is missing");await b("/save-user-data",e,t)}async function Ze(){const e=v();return await C("/get-user-data",e)}async function ln(){var n,s,o,r;const e=cn();if(!e.gender||!e.age||!e.weight||!e.height||!e.activityLevel||!e.goal){console.warn("No user data found in local storage. Skipping initial save.");return}console.warn("Saving initial user data to DB...");const t={gender:e.gender,age:e.age,weight_kg:(n=e.weight)==null?void 0:n.kg,weight_pounds:(s=e.weight)==null?void 0:s.pounds,height_cm:(o=e.height)==null?void 0:o.cm,height_feet_and_inches:(r=e.height)==null?void 0:r.feetAndInches,activityLevel:e.activityLevel,goal:e.goal};try{await Xe(t),localStorage.removeItem("userData")}catch(i){console.error("Failed to save initial user data to DB:",i)}}async function oe(e){const t=v();if(console.log("Data being sent to save-next-meals:",e),!t||!e)throw new Error("Token or UserInfo is missing");await b("/save-next-meals",{next_meals:e},t)}async function dn(){const e=v();return await C("/get-next-meals",e)}async function un(e){const t=v();if(!t||!Array.isArray(e)||e.length===0)throw new Error("Token or items list is missing or empty");await b("/set-user-list-items",{items:e},t)}async function mn(){const e=v();return await C("/get-user-list-items",e)}async function fn(e){const t=v();if(!t||!e)throw new Error("Token or item is missing");await b("/add-user-list-item",e,t)}async function gn(e){const t=v();if(!t||!e)throw new Error("Token or identifier is missing");await b("/delete-user-list-item",{identifier:e},t)}async function Le(e,t){const n=v();if(!n||!e||!t)throw new Error("Token, identifier or updatedItem is missing");await b("/update-user-list-item",{identifier:e,updatedItem:t},n)}async function hn(){const e=v();return await b("/delete-old-and-create-new-list",{},e)}async function X(e,t,n){const s=v();if(!s||!t||!["like","dislike","neutral"].includes(n)||!["dish","ingredient"].includes(e))throw new Error("Invalid input");await b("/set-user-preference",{type:e,id:t,preference:n},s)}async function Qe(){const e=v();if(!e)throw new Error("Token missing");return await C("/get-user-preferences",e)}function H(e,t,n){let s=!1,o=!1,r=0,i=0,a=0,l=null,d=null,c=null,m=!1;const g=500,E=90,h=30,f=()=>{m=!0,setTimeout(()=>{m=!1},g)},y=async u=>{u&&(u.style.maxHeight="".concat(u.offsetHeight,"px"),requestAnimationFrame(()=>{u.classList.add("deleting")}),u.addEventListener("transitionend",async()=>{let p=u.querySelector(".item-id");if(u.remove(),p){let w=parseInt(p.textContent,10);w?await n(w):await n(p.textContent)}},{once:!0}))},x=u=>{e.querySelectorAll(t).forEach(p=>{if(p!==u){const w=p.querySelector(".swipe-content"),k=p.querySelector(".swipe-delete");w&&(w.style.transform="translateX(0)",w.style.borderRadius="0px"),k&&(k.style.width="0px",k.style.opacity="0")}})},W=u=>{if(!c||!o)return;const p=Math.abs(u);p>0?(c.style.width="".concat(p,"px"),c.style.opacity="1"):(c.style.width="0px",c.style.opacity="0")},A=u=>{if(m)return;const p=u.target.closest(t);!p||u.target.closest("button")||u.target.closest("object")||u.target.classList.contains("swipe-delete")||(x(p),s=!0,o=!1,l=p,d=p.querySelector(".swipe-content"),c=p.querySelector(".swipe-delete"),r=u.type.includes("mouse")?u.pageX:u.touches[0].pageX,i=u.type.includes("mouse")?u.pageY:u.touches[0].pageY,a=r)},M=u=>{if(!s||!d)return;a=u.type.includes("mouse")?u.pageX:u.touches[0].pageX;const p=u.type.includes("mouse")?u.pageY:u.touches[0].pageY;let w=a-r,k=Math.abs(p-i);if(!o){if(k>h){s=!1;return}if(w<-20)o=!0,c&&(c.style.width="0px",c.style.opacity="0",c.style.transition="none"),d&&(d.style.transition="none");else return}o&&w<=0&&(d.style.transform="translateX(".concat(w,"px)"),W(w))},$=()=>{if(!s||!d)return;if(s=!1,!o){o=!1;return}let u=a-r;d.style.transition="transform 0.3s ease-out, border-radius 0.3s ease-out",c&&(c.style.transition="width 0.3s ease-out, opacity 0.3s ease-out"),u<-150?(f(),d.style.transform="translateX(-100%)",d.style.borderRadius="0 0 0 0",c&&(c.style.width="100%",c.style.opacity="1"),d.addEventListener("transitionend",()=>y(l),{once:!0})):u<-30?(d.style.transform="translateX(-".concat(E,"px)"),d.style.borderRadius="0 0 0 0",c&&(c.style.width="".concat(E,"px"),c.style.opacity="1")):(d.style.transform="translateX(0)",d.style.borderRadius="0px",c&&(c.style.width="0px",c.style.opacity="0")),o=!1},le=u=>{if(!m&&u.target.classList.contains("swipe-delete")){const p=u.target.closest(t);f(),y(p)}},O=u=>{const p=e.querySelectorAll(t);let w=u.target.closest(t);p.forEach(k=>{const I=k.querySelector(".swipe-content"),L=k.querySelector(".swipe-delete");I&&I.style.transform&&I.style.transform!=="translateX(0px)"&&I.style.transform!==""&&k!==w&&(I.style.transition="transform 0.3s ease-out, border-radius 0.3s ease-out",I.style.transform="translateX(0)",I.style.borderRadius="0px",L&&(L.style.transition="width 0.3s ease-out, opacity 0.3s ease-out",L.style.width="0px",L.style.opacity="0"))})};e.addEventListener("mousedown",A),document.addEventListener("mousemove",M),document.addEventListener("mouseup",$),e.addEventListener("touchstart",A,{passive:!0}),document.addEventListener("touchmove",M,{passive:!0}),document.addEventListener("touchend",$),e.addEventListener("click",le),document.addEventListener("click",O)}class Z{constructor(t,n=null){this.element=t,this.trigger=t.querySelector(".select-trigger"),this.dropdown=t.querySelector(".select-dropdown"),this.options=t.querySelectorAll(".select-option"),this.selectedText=t.querySelector(".select-text"),this.arrow=t.querySelector(".select-arrow"),this.isOpen=!1,this.selectedValue=null,this.onChangeCallback=n,this.init()}init(){this.trigger.addEventListener("click",t=>{t.stopPropagation(),this.toggle()}),this.options.forEach(t=>{t.addEventListener("click",n=>{console.log("Option clicked:",t.textContent),n.stopPropagation(),this.selectOption(t)})}),document.addEventListener("click",t=>{!this.element.contains(t.target)&&this.isOpen&&this.close()}),this.element.addEventListener("keydown",t=>{this.handleKeyPress(t)}),this.initializeDefault(),this.trigger.setAttribute("tabindex","0"),this.options.forEach(t=>{t.addEventListener("touchstart",n=>{t.classList.add("touching")}),t.addEventListener("touchend",n=>{t.classList.remove("touching")})})}initializeDefault(){const t=this.element.querySelector(".select-option.selected");if(t){this.selectedText.textContent=t.textContent,this.selectedValue=t.dataset.value;return}const n=this.options[0];n&&this.selectOption(n)}toggle(){console.log("Toggle called, isOpen:",this.isOpen),this.isOpen?this.close():this.open()}open(){console.log("Opening dropdown"),this.isOpen=!0,this.trigger.classList.add("active"),this.dropdown.classList.add("active"),this.trigger.setAttribute("aria-expanded","true")}close(){console.log("Closing dropdown"),this.isOpen=!1,this.trigger.classList.remove("active"),this.dropdown.classList.remove("active"),this.trigger.setAttribute("aria-expanded","false")}selectOption(t){this.options.forEach(s=>s.classList.remove("selected")),t.classList.add("selected"),this.selectedText.textContent=t.textContent,this.selectedValue=t.dataset.value,this.close(),this.onChangeCallback&&this.onChangeCallback(this.selectedValue,t.textContent);const n=new CustomEvent("change",{detail:{value:this.selectedValue,text:t.textContent}});this.element.dispatchEvent(n)}handleKeyPress(t){switch(t.key){case"Enter":case" ":t.preventDefault(),this.isOpen||this.open();break;case"Escape":this.close();break;case"ArrowDown":t.preventDefault(),this.navigateOptions(1);break;case"ArrowUp":t.preventDefault(),this.navigateOptions(-1);break}}navigateOptions(t){if(!this.isOpen){this.open();return}let s=Array.from(this.options).findIndex(o=>o.classList.contains("selected"))+t;s<0&&(s=this.options.length-1),s>=this.options.length&&(s=0),this.selectOption(this.options[s])}getValue(){return this.selectedValue}setValue(t){const n=Array.from(this.options).find(s=>s.dataset.value===t);n&&this.selectOption(n)}}function pn(){document.querySelectorAll(".custom-select").forEach(t=>{new Z(t)})}function Q(e,t){const n=document.getElementById(e);n&&t&&n.addEventListener("input",()=>{const s=n.value.toLowerCase();t.forEach(o=>{document.querySelectorAll("".concat(o," li")).forEach(r=>{r.style.display=r.textContent.toLowerCase().includes(s)?"":"none"})})})}async function yn(){const e=document.getElementById("app"),t=await T("./html-pages/settings.html");e.innerHTML=t,bn(),ae(),Se(),kn(),await vn()}function et(e){return e.toString().replace(",",".")}async function vn(){const{gender:e,age:t,weight_kg:n,weight_pounds:s,height_cm:o,height_feet_and_inches:r,activityLevel:i,goal:a}=await Ze(),l=document.getElementById("height-st"),d=document.getElementById("weight-st"),c=document.getElementById("age-st"),m=document.getElementById("sex-st");l.value=o,d.value=et(n.toFixed(1)),c.value=t,l.placeholder="cm",d.placeholder="kg",c.placeholder="years",e?m.textContent=e.toLowerCase():m.textContent="",document.querySelectorAll("#activity-container .card-st-activity").forEach(h=>{h.querySelector(".al-text-st").textContent===i?h.classList.add("clicked-st-activity"):h.classList.remove("clicked-st-activity")}),document.querySelectorAll("#goal-container .card-st-goal").forEach(h=>{h.querySelector(".al-text-st").textContent===a?h.classList.add("clicked-st-goal"):h.classList.remove("clicked-st-goal")})}function wn(){const e=document.getElementById("height-st"),t=document.getElementById("weight-st"),n=document.getElementById("age-st"),s=document.getElementById("sex-st"),o=parseFloat(e.value),r=parseFloat(et(t.value)),i=parseInt(n.value,10),a=s.textContent,l=(r*2.20462).toFixed(1),d=o/2.54,c=Math.floor(d/12),m=Math.round(d%12),g="".concat(c,"' ").concat(m,'"'),E=document.querySelector("#activity-container .clicked-st-activity .al-text-st"),h=E?E.textContent:null,f=document.querySelector("#goal-container .clicked-st-goal .al-text-st"),y=f?f.textContent:null;Xe({gender:a,age:i,weight_kg:r,weight_pounds:l,height_cm:o,height_feet_and_inches:g,activityLevel:h,goal:y})}function Se(){const e=localStorage.getItem("theme")||"light";document.body.classList.toggle("dark-mode",e==="dark")}function En(){const e=localStorage.getItem("theme")||"light",t=document.querySelector(".custom-select.sex-field");new Z(t);const n=document.querySelector(".custom-select.theme-field");new Z(n,o=>{const r=o;localStorage.setItem("theme",r),document.body.classList.toggle("dark-mode",r==="dark")}).setValue(e)}function kn(){En();const e=document.getElementById("weight-st");e.addEventListener("keypress",o=>{const r=e.value,i=/^[0-9]*([.,][0-9]*)?$/,a=r+o.key;i.test(a)||o.preventDefault()});const t=document.querySelector(".bigger-hitbox-st");t&&t.addEventListener("click",In);const n=document.querySelectorAll(".card-st-activity");n.forEach(o=>{o.addEventListener("click",function(){n.forEach(r=>r.classList.remove("clicked-st-activity")),this.classList.add("clicked-st-activity")})});const s=document.querySelectorAll(".card-st-goal");s.forEach(o=>{o.addEventListener("click",function(){s.forEach(r=>r.classList.remove("clicked-st-goal")),this.classList.add("clicked-st-goal")})}),document.getElementById("logout-btn").addEventListener("click",ze)}function re(){const e=document.querySelector(".settings");e&&e.addEventListener("click",function(){window.location.href="#settings"})}function bn(){const e=document.getElementById("main-nav");e&&(e.classList.add("hiddenNav"),e.classList.remove("showNav"))}function Oe(){const e=rr();window.location.href=e}function In(){if(!Ln()){Oe();return}console.log("Settings saved!"),wn(),Oe()}function Ln(){const e=document.getElementById("height-st").value.trim(),t=document.getElementById("weight-st").value.trim(),n=document.getElementById("age-st").value.trim(),s=document.getElementById("sex-st").textContent.trim();return e&&t&&n&&s}const Sn="modulepreload",Cn=function(e,t){return new URL(e,t).href},Ne={},xn=function(t,n,s){let o=Promise.resolve();if(n&&n.length>0){let d=function(c){return Promise.all(c.map(m=>Promise.resolve(m).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};const i=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));o=d(n.map(c=>{if(c=Cn(c,s),c in Ne)return;Ne[c]=!0;const m=c.endsWith(".css"),g=m?'[rel="stylesheet"]':"";if(!!s)for(let f=i.length-1;f>=0;f--){const y=i[f];if(y.href===c&&(!m||y.rel==="stylesheet"))return}else if(document.querySelector('link[href="'.concat(c,'"]').concat(g)))return;const h=document.createElement("link");if(h.rel=m?"stylesheet":Sn,m||(h.as="script"),h.crossOrigin="",h.href=c,l&&h.setAttribute("nonce",l),document.head.appendChild(h),m)return new Promise((f,y)=>{h.addEventListener("load",f),h.addEventListener("error",()=>y(new Error("Unable to preload CSS for ".concat(c))))})}))}function r(i){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=i,window.dispatchEvent(a),!a.defaultPrevented)throw i}return o.then(i=>{for(const a of i||[])a.status==="rejected"&&r(a.reason);return t().catch(r)})};/*! Capacitor: https://capacitorjs.com/ - MIT License */var q;(function(e){e.Unimplemented="UNIMPLEMENTED",e.Unavailable="UNAVAILABLE"})(q||(q={}));class de extends Error{constructor(t,n,s){super(t),this.message=t,this.code=n,this.data=s}}const Bn=e=>{var t,n;return e!=null&&e.androidBridge?"android":!((n=(t=e==null?void 0:e.webkit)===null||t===void 0?void 0:t.messageHandlers)===null||n===void 0)&&n.bridge?"ios":"web"},Dn=e=>{const t=e.CapacitorCustomPlatform||null,n=e.Capacitor||{},s=n.Plugins=n.Plugins||{},o=()=>t!==null?t.name:Bn(e),r=()=>o()!=="web",i=m=>{const g=d.get(m);return!!(g!=null&&g.platforms.has(o())||a(m))},a=m=>{var g;return(g=n.PluginHeaders)===null||g===void 0?void 0:g.find(E=>E.name===m)},l=m=>e.console.error(m),d=new Map,c=(m,g={})=>{const E=d.get(m);if(E)return console.warn('Capacitor plugin "'.concat(m,'" already registered. Cannot register plugins twice.')),E.proxy;const h=o(),f=a(m);let y;const x=async()=>(!y&&h in g?y=typeof g[h]=="function"?y=await g[h]():y=g[h]:t!==null&&!y&&"web"in g&&(y=typeof g.web=="function"?y=await g.web():y=g.web),y),W=(u,p)=>{var w,k;if(f){const I=f==null?void 0:f.methods.find(L=>p===L.name);if(I)return I.rtype==="promise"?L=>n.nativePromise(m,p.toString(),L):(L,G)=>n.nativeCallback(m,p.toString(),L,G);if(u)return(w=u[p])===null||w===void 0?void 0:w.bind(u)}else{if(u)return(k=u[p])===null||k===void 0?void 0:k.bind(u);throw new de('"'.concat(m,'" plugin is not implemented on ').concat(h),q.Unimplemented)}},A=u=>{let p;const w=(...k)=>{const I=x().then(L=>{const G=W(L,u);if(G){const V=G(...k);return p=V==null?void 0:V.remove,V}else throw new de('"'.concat(m,".").concat(u,'()" is not implemented on ').concat(h),q.Unimplemented)});return u==="addListener"&&(I.remove=async()=>p()),I};return w.toString=()=>"".concat(u.toString(),"() { [capacitor code] }"),Object.defineProperty(w,"name",{value:u,writable:!1,configurable:!1}),w},M=A("addListener"),$=A("removeListener"),le=(u,p)=>{const w=M({eventName:u},p),k=async()=>{const L=await w;$({eventName:u,callbackId:L},p)},I=new Promise(L=>w.then(()=>L({remove:k})));return I.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await k()},I},O=new Proxy({},{get(u,p){switch(p){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return f?le:M;case"removeListener":return $;default:return A(p)}}});return s[m]=O,d.set(m,{name:m,proxy:O,platforms:new Set([...Object.keys(g),...f?[h]:[]])}),O};return n.convertFileSrc||(n.convertFileSrc=m=>m),n.getPlatform=o,n.handleError=l,n.isNativePlatform=r,n.isPluginAvailable=i,n.registerPlugin=c,n.Exception=de,n.DEBUG=!!n.DEBUG,n.isLoggingEnabled=!!n.isLoggingEnabled,n},_n=e=>e.Capacitor=Dn(e),ee=_n(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),ie=ee.registerPlugin;class tt{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(t,n){let s=!1;this.listeners[t]||(this.listeners[t]=[],s=!0),this.listeners[t].push(n);const r=this.windowListeners[t];r&&!r.registered&&this.addWindowListener(r),s&&this.sendRetainedArgumentsForEvent(t);const i=async()=>this.removeListener(t,n);return Promise.resolve({remove:i})}async removeAllListeners(){this.listeners={};for(const t in this.windowListeners)this.removeWindowListener(this.windowListeners[t]);this.windowListeners={}}notifyListeners(t,n,s){const o=this.listeners[t];if(!o){if(s){let r=this.retainedEventArguments[t];r||(r=[]),r.push(n),this.retainedEventArguments[t]=r}return}o.forEach(r=>r(n))}hasListeners(t){var n;return!!(!((n=this.listeners[t])===null||n===void 0)&&n.length)}registerWindowListener(t,n){this.windowListeners[n]={registered:!1,windowEventName:t,pluginEventName:n,handler:s=>{this.notifyListeners(n,s)}}}unimplemented(t="not implemented"){return new ee.Exception(t,q.Unimplemented)}unavailable(t="not available"){return new ee.Exception(t,q.Unavailable)}async removeListener(t,n){const s=this.listeners[t];if(!s)return;const o=s.indexOf(n);this.listeners[t].splice(o,1),this.listeners[t].length||this.removeWindowListener(this.windowListeners[t])}addWindowListener(t){window.addEventListener(t.windowEventName,t.handler),t.registered=!0}removeWindowListener(t){t&&(window.removeEventListener(t.windowEventName,t.handler),t.registered=!1)}sendRetainedArgumentsForEvent(t){const n=this.retainedEventArguments[t];n&&(delete this.retainedEventArguments[t],n.forEach(s=>{this.notifyListeners(t,s)}))}}const Ue=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),Fe=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class Tn extends tt{async getCookies(){const t=document.cookie,n={};return t.split(";").forEach(s=>{if(s.length<=0)return;let[o,r]=s.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");o=Fe(o).trim(),r=Fe(r).trim(),n[o]=r}),n}async setCookie(t){try{const n=Ue(t.key),s=Ue(t.value),o="; expires=".concat((t.expires||"").replace("expires=","")),r=(t.path||"/").replace("path=",""),i=t.url!=null&&t.url.length>0?"domain=".concat(t.url):"";document.cookie="".concat(n,"=").concat(s||"").concat(o,"; path=").concat(r,"; ").concat(i,";")}catch(n){return Promise.reject(n)}}async deleteCookie(t){try{document.cookie="".concat(t.key,"=; Max-Age=0")}catch(n){return Promise.reject(n)}}async clearCookies(){try{const t=document.cookie.split(";")||[];for(const n of t)document.cookie=n.replace(/^ +/,"").replace(/=.*/,"=;expires=".concat(new Date().toUTCString(),";path=/"))}catch(t){return Promise.reject(t)}}async clearAllCookies(){try{await this.clearCookies()}catch(t){return Promise.reject(t)}}}ie("CapacitorCookies",{web:()=>new Tn});const An=async e=>new Promise((t,n)=>{const s=new FileReader;s.onload=()=>{const o=s.result;t(o.indexOf(",")>=0?o.split(",")[1]:o)},s.onerror=o=>n(o),s.readAsDataURL(e)}),Pn=(e={})=>{const t=Object.keys(e);return Object.keys(e).map(o=>o.toLocaleLowerCase()).reduce((o,r,i)=>(o[r]=e[t[i]],o),{})},qn=(e,t=!0)=>e?Object.entries(e).reduce((s,o)=>{const[r,i]=o;let a,l;return Array.isArray(i)?(l="",i.forEach(d=>{a=t?encodeURIComponent(d):d,l+="".concat(r,"=").concat(a,"&")}),l.slice(0,-1)):(a=t?encodeURIComponent(i):i,l="".concat(r,"=").concat(a)),"".concat(s,"&").concat(l)},"").substr(1):null,Mn=(e,t={})=>{const n=Object.assign({method:e.method||"GET",headers:e.headers},t),o=Pn(e.headers)["content-type"]||"";if(typeof e.data=="string")n.body=e.data;else if(o.includes("application/x-www-form-urlencoded")){const r=new URLSearchParams;for(const[i,a]of Object.entries(e.data||{}))r.set(i,a);n.body=r.toString()}else if(o.includes("multipart/form-data")||e.data instanceof FormData){const r=new FormData;if(e.data instanceof FormData)e.data.forEach((a,l)=>{r.append(l,a)});else for(const a of Object.keys(e.data))r.append(a,e.data[a]);n.body=r;const i=new Headers(n.headers);i.delete("content-type"),n.headers=i}else(o.includes("application/json")||typeof e.data=="object")&&(n.body=JSON.stringify(e.data));return n};class $n extends tt{async request(t){const n=Mn(t,t.webFetchExtra),s=qn(t.params,t.shouldEncodeUrlParams),o=s?"".concat(t.url,"?").concat(s):t.url,r=await fetch(o,n),i=r.headers.get("content-type")||"";let{responseType:a="text"}=r.ok?t:{};i.includes("application/json")&&(a="json");let l,d;switch(a){case"arraybuffer":case"blob":d=await r.blob(),l=await An(d);break;case"json":l=await r.json();break;case"document":case"text":default:l=await r.text()}const c={};return r.headers.forEach((m,g)=>{c[g]=m}),{data:l,headers:c,status:r.status,url:r.url}}async get(t){return this.request(Object.assign(Object.assign({},t),{method:"GET"}))}async post(t){return this.request(Object.assign(Object.assign({},t),{method:"POST"}))}async put(t){return this.request(Object.assign(Object.assign({},t),{method:"PUT"}))}async patch(t){return this.request(Object.assign(Object.assign({},t),{method:"PATCH"}))}async delete(t){return this.request(Object.assign(Object.assign({},t),{method:"DELETE"}))}}ie("CapacitorHttp",{web:()=>new $n});var He;(function(e){e.Heavy="HEAVY",e.Medium="MEDIUM",e.Light="LIGHT"})(He||(He={}));var Re;(function(e){e.Success="SUCCESS",e.Warning="WARNING",e.Error="ERROR"})(Re||(Re={}));const On=ie("Haptics",{web:()=>xn(()=>import("./web-DV2sorp1.js"),[],import.meta.url).then(e=>new e.HapticsWeb)});var je;(function(e){e.Dark="DARK",e.Light="LIGHT",e.Default="DEFAULT"})(je||(je={}));var We;(function(e){e.None="NONE",e.Slide="SLIDE",e.Fade="FADE"})(We||(We={}));ie("StatusBar");const Nn=ee.isNativePlatform();async function Un(){if(!Nn){console.log("Haptics: Vibrate requested, but platform is not native.");return}await On.vibrate()}let B,nt;async function Fn(){Un(),B=await Ye(),nt=await Ie(),j();const e=document.getElementById("app"),t=await T("./html-pages/meals.html");e.innerHTML=t,Se(),gs(),ae(),Kn(),hs(),re(),Hn(),pn(),Rn(),jn(),Wn(),Vn();const n=await Qe();console.warn("Preferences loaded:",n),Jn(n),ts()}function Hn(){document.querySelectorAll("#filter-bar-p button").forEach(t=>{t.addEventListener("click",()=>{document.querySelector("#food-p").scrollTop=0,zn(t)})})}function Rn(){document.querySelectorAll(".like").forEach(n=>{n.addEventListener("click",Ce)}),document.querySelectorAll(".dislike").forEach(n=>{n.addEventListener("click",xe)})}function jn(){Q("search-preferences",["#dishes-list-p","#ingredients-list-p"]),Q("search-ingredients",["#ingredientsContainer"])}function Wn(){document.getElementById("add-meal-p").addEventListener("click",function(e){rs(),qe()}),document.getElementById("closeMealBtn").addEventListener("click",function(e){N(),S()}),document.getElementById("addBtn-p").addEventListener("click",cs),document.getElementById("addTagBtn").addEventListener("click",ue),document.getElementById("tagInput").addEventListener("keypress",function(e){e.key==="Enter"&&(e.preventDefault(),ue())}),document.getElementById("editMealOverlay").addEventListener("click",function(e){e.target===this&&(N(),S())}),document.getElementById("navOverlay").addEventListener("click",function(e){Gn()&&(N(),S())}),document.getElementById("tagInput").addEventListener("keypress",function(e){e.key==="Enter"&&(e.preventDefault(),ue())}),document.getElementById("editMealOverlay").addEventListener("click",function(e){e.target===this&&(N(),S())})}function Gn(){return document.querySelector(".meals-container")!=null}function Vn(){document.getElementById("add-ingredient-p").addEventListener("click",function(e){is(),qe()}),document.getElementById("closeIngredientBtn").addEventListener("click",function(e){J(),S()}),document.getElementById("addIngredientSubmitBtn").addEventListener("click",us),document.getElementById("editIngredientOverlay").addEventListener("click",function(e){e.target===this&&(J(),S())}),document.getElementById("navOverlay").addEventListener("click",function(e){J(),S()})}async function Kn(){nt.forEach(e=>{rt(e.name,e.dish_id,e.total_calories,e.preparation_time_in_min,JSON.parse(e.tags))}),B.forEach(e=>{it(e.name,e.ingredient_id,e.category)})}function zn(e){document.querySelectorAll("#filter-bar-p button").forEach(n=>{n===e?(Yn(e),n.classList.add("active-p"),n.classList.remove("notActive-p")):(n.classList.remove("active-p"),n.classList.add("notActive-p"))})}function Yn(e){const t=document.querySelector("#ingredients-preferences"),n=document.querySelector("#meals-preferences"),s=e.textContent.trim(),o=document.getElementById("ingredientsPreferredWhole"),r=document.getElementById("ingredientsBlockedWhole"),i=document.getElementById("mealsPreferredWhole"),a=document.getElementById("mealsBlockedWhole");t.style.display=s==="Meals"?"none":"",n.style.display=s==="Ingredients"?"none":"",o.style.display=s==="Meals"?"none":"",r.style.display=s==="Meals"?"none":"",i.style.display=s==="Ingredients"?"none":"",a.style.display=s==="Ingredients"?"none":""}function Jn(e){const t=e.blockedDishes,n=e.blockedIngredients,s=e.preferredDishes,o=e.preferredIngredients,r=document.querySelectorAll(".dish-card-p"),i=document.querySelectorAll(".ingredient-card-p");Xn(r,s,t),Zn(i,o,n)}function Xn(e,t,n){e.forEach(s=>{const o=s.querySelector(".item-id").textContent.trim(),r=s.querySelector(".like"),i=s.querySelector(".dislike");t.includes(parseInt(o,10))&&r.classList.add("favorited"),n.includes(parseInt(o,10))&&i.classList.add("rejected")})}function Zn(e,t,n){e.forEach(s=>{const o=s.querySelector(".item-id").textContent.trim(),r=s.querySelector(".like"),i=s.querySelector(".dislike");t.includes(parseInt(o,10))&&r.classList.add("favorited"),n.includes(parseInt(o,10))&&i.classList.add("rejected")})}function st(e){const[t,n]=e.split("-"),s=parseInt(n,10);if(!t||isNaN(s))throw new Error("Invalid dataId format: ".concat(e));return[t,s]}async function Ce(e){const t=e.currentTarget,n=t.dataset.meal,[s,o]=st(n),r=s==="ingredient",i=s==="dish";if(t.classList.toggle("favorited"),t.classList.contains("favorited")){const a=document.querySelector('[data-meal="'.concat(n,'"].dislike'));a&&a.classList.contains("rejected")&&(a.classList.remove("rejected"),P("rejected",!1,r,i)),P("favorited",!0,r,i),X(s,o,"like").catch(l=>console.error("Failed to update preference:",l))}else P("favorited",!1,r,i),X(s,o,"neutral").catch(a=>console.error("Failed to update preference:",a))}function xe(e){const t=e.currentTarget,n=t.dataset.meal,[s,o]=st(n),r=s==="ingredient",i=s==="dish";if(t.classList.toggle("rejected"),t.classList.contains("rejected")){const a=document.querySelector('[data-meal="'.concat(n,'"].like'));a&&a.classList.contains("favorited")&&(a.classList.remove("favorited"),P("favorited",!1,r,i)),P("rejected",!0,r,i),X(s,o,"dislike").catch(l=>console.error("Failed to update preference:",l))}else P("rejected",!1,r,i),X(s,o,"neutral").catch(a=>console.error("Failed to update preference:",a))}function P(e,t,n,s){if(n){const o=document.getElementById("ingredientsPreferred"),r=document.getElementById("ingredientsBlocked");e==="favorited"?z(o,t):e==="rejected"&&z(r,t)}else if(s){const o=document.getElementById("mealsPreferred"),r=document.getElementById("mealsBlocked");e==="favorited"?z(o,t):e==="rejected"&&z(r,t)}}function te(e){const n={dish:{selector:".dish-card-p",counters:{preferred:"mealsPreferred",blocked:"mealsBlocked"}},ingredient:{selector:".ingredient-card-p",counters:{preferred:"ingredientsPreferred",blocked:"ingredientsBlocked"}}}[e];if(!n){console.error("Invalid item type: ".concat(e));return}const s=document.querySelectorAll(n.selector);let o=0,r=0;s.forEach(l=>{const d=l.querySelector(".like"),c=l.querySelector(".dislike");d!=null&&d.classList.contains("favorited")&&o++,c!=null&&c.classList.contains("rejected")&&r++});const i=document.getElementById(n.counters.preferred),a=document.getElementById(n.counters.blocked);i&&(i.textContent=o),a&&(a.textContent=r)}function Qn(){te("dish")}function es(){te("ingredient")}function ts(){te("dish"),te("ingredient")}function z(e,t){if(e){const n=Number(e.textContent)||0,s=t?n+1:n-1;e.textContent=Math.max(0,s)}}async function ns(){const e=document.getElementById("ingredientsContainer");B.forEach(t=>{const n=ot(t.Unit_of_Measurement);e.innerHTML+='\n    <li class="card ingredient">\n            <input class="checkbox-overlay" type="checkbox">\n            <span class="ingredient-text-p">'.concat(t.name,'</span>\n            <div class="ingredient-amount-p">\n                <input type="number" class="form-input ingredient" placeholder="0">\n                <span class="amount-text-p">').concat(n,"</span>\n            </div>\n    </li>\n  ")})}function ot(e){return e?e.replace(/[0-9]/g,"").toLowerCase():""}function ss(){const e=document.querySelectorAll("#ingredientsContainer .checkbox-overlay"),t=[];return e.forEach((n,s)=>{if(n.checked){const r=n.closest(".card.ingredient").querySelector(".form-input.ingredient"),i=parseFloat(r.value)||0;t.push([s,i])}}),t}function os(){const e=ss();let t=0,n=0,s=0,o=0,r=[];return e.forEach(i=>{const[a,l]=i;t+=B[a].calories_per_UoM/100*l,n+=B[a].protein_per_UoM/100*l,s+=B[a].carbs_per_UoM/100*l,o+=B[a].fats_per_UoM/100*l;let d=ot(B[a].Unit_of_Measurement);r.push({ingredient_id:B[a].ingredient_id,unit_of_measurement:d,amount:l})}),{calories:Math.round(t),protein:Math.round(n),carbs:Math.round(s),fat:Math.round(o),ingredients:r}}function rs(){const e=document.getElementById("editMealOverlay"),t=e.querySelector(".form-section");document.body.style.overflow="hidden",e.classList.remove("hidden"),t&&(t.scrollTop=0),ns()}function N(){const e=document.getElementById("editMealOverlay");e&&(e.classList.add("hidden"),document.body.style.overflow="auto")}function is(){const e=document.getElementById("editIngredientOverlay"),t=e.querySelector(".form-section-ingredient");document.body.style.overflow="hidden",e.classList.remove("hidden"),t&&(t.scrollTop=0)}function J(){const e=document.getElementById("editIngredientOverlay");e&&(e.classList.add("hidden"),document.body.style.overflow="auto")}function ue(){const e=document.getElementById("tagInput"),t=e.value.trim();if(t){const n=document.getElementById("tagsContainer"),s=document.createElement("div");s.className="tag-o-p",s.innerHTML="\n                    <span>".concat(t,'</span>\n                    <button class="tag-remove">\n                    <img src="./assets/icons/remove-tag.svg" alt="">\n                    </button>\n                '),n.appendChild(s),e.value="";const o=document.querySelector(".tag-remove");o.addEventListener("click",function(){o.parentElement.remove()})}}function as(e){if(!e.name||e.name.trim()==="")return alert("Please enter a meal name."),!1;if(!e.time||isNaN(e.time)||parseInt(e.time)<=0)return alert("Please enter a valid cooking time (greater than 0)."),!1;if(!e.vmScore||isNaN(e.vmScore))return alert("Please enter a valid VM score."),!1;if(!e.category||e.category==="Select Category"||e.category==="Protein")return alert("Please select a valid category."),!1;if(!e.preparation||e.preparation.trim()==="")return alert("Please enter cooking instructions."),!1;if(!e.ingredients||e.ingredients.length===0)return alert("Please select at least one ingredient."),!1;for(let t of e.ingredients)if(!t.amount||isNaN(t.amount)||parseFloat(t.amount)<=0)return alert("Please enter a valid amount for ingredient ID: ".concat(t.ingredient_id,".")),!1;return!0}function rt(e,t,n,s,o=[],r="#dishes-list-p"){const i="dish-".concat(t),a=o.map(E=>'<button class="tag-p">'.concat(E,"</button>")).join(""),l='\n    <li class="card drop-shadow dish-card-p">\n        <div class="swipe-delete">Delete</div>\n        <div class="swipe-content">\n            <span class="item-id">'.concat(t,'</span>\n            <div class="first-row-of-dish">\n                <div class="descr-p">\n                    <h3 class="title-p">').concat(e,'</h3>\n                    <div class="dish-info-p">\n                        <p class="subtext">').concat(n,' ckal</p>\n                        <div class="subtext-point"></div>\n                        <p class="subtext">').concat(s,' min</p>\n                    </div>\n                </div>\n                <div class="preference-buttons">\n                    <button class="like" data-meal="').concat(i,'">\n                        <svg class="star-icon" src="./assets/icons/star.svg" alt="star"></svg>\n                    </button>\n                    <button class="dislike" data-meal="').concat(i,'">\n                        <svg class="cross-icon" viewBox="0 0 24 24" fill="none" stroke-width="2"\n                            stroke-linecap="round" stroke-linejoin="round">\n                            <line x1="18" y1="6" x2="6" y2="18"></line>\n                            <line x1="6" y1="6" x2="18" y2="18"></line>\n                        </svg>\n                    </button>\n                </div>\n            </div>\n            <div class="tags-container-p">\n                ').concat(a,"\n            </div>\n        </div>\n    </li>\n    "),d=document.querySelector(r);if(!d)return;d.insertAdjacentHTML("beforeend",l);const c=d.lastElementChild,m=c.querySelector(".like"),g=c.querySelector(".dislike");m.addEventListener("click",Ce),g.addEventListener("click",xe)}async function cs(){const e=document.getElementById("addBtn-p");e.disabled=!0;const t=os(),n=document.getElementById("mealName-p").value,s=t.calories,o=t.protein,r=t.fat,i=t.carbs,a=document.getElementById("time-p").value,l=document.getElementById("vmScore-p").value;let d=document.getElementById("category-p").textContent.trim();const c=Array.from(document.querySelectorAll(".tag-o-p span")).map(f=>f.textContent),m=t.ingredients,g=document.getElementById("instructions-p").value,E=JSON.stringify(c);d==="lunch/dinner"&&(d="Main");const h={name:n,preparation:g,vmScore:l,category:d,time:a,calories:s,protein:o,fat:r,carbs:i,tags:E,ingredients:m};if(as(h)){N();const y=(await tn(h)).dishId;rt(n,y,s,a,c),ls()}e.disabled=!1}function ls(){document.getElementById("mealName-p").value="",document.getElementById("time-p").value="",document.getElementById("vmScore-p").value="",document.getElementById("instructions-p").value="",document.getElementById("tagsContainer").innerHTML="",document.getElementById("ingredientsContainer").innerHTML="",document.getElementById("category-p").textContent="breakfast";const e=document.getElementById("editMealOverlay");e.scrollTop=0;const t=e.querySelector(".add-meal-card");t&&(t.scrollTop=0)}function it(e,t,n,s="ingredients-list-p"){const o="ingredient-".concat(t),r='\n        <li class="card drop-shadow ingredient-card-p">\n            <span class="item-id">'.concat(t,'</span>\n            <div class="swipe-delete">Delete</div>\n            <div class="swipe-content">\n                <div class="descr-p">\n                    <h3 class="title-p">').concat(e,'</h3>\n                    <p class="subtext">').concat(n,'</p>\n                </div>\n\n                <div class="preference-buttons">\n                    <button class="like" data-meal="').concat(o,'">\n                        <img class="star-icon" src="./assets/icons/star.svg" alt="star">\n                    </button>\n                    <button class="dislike" data-meal="').concat(o,'">\n                        <svg class="cross-icon" viewBox="0 0 24 24" fill="none" stroke-width="2"\n                            stroke-linecap="round" stroke-linejoin="round">\n                            <line x1="18" y1="6" x2="6" y2="18"></line>\n                            <line x1="6" y1="6" x2="18" y2="18"></line>\n                        </svg>\n                    </button>\n                </div>\n            </div>\n        </li>\n    '),i=document.getElementById(s);if(!i)return;i.insertAdjacentHTML("beforeend",r);const a=i.lastElementChild,l=a.querySelector(".like"),d=a.querySelector(".dislike");l.addEventListener("click",Ce),d.addEventListener("click",xe)}function ds(e){return!e.name||e.name.trim()===""?(alert("Please enter an ingredient name."),document.getElementById("ingredientName-p").focus(),!1):!e.category||e.category.trim()===""||e.category==="Select Category"?(alert("Please select a category."),document.getElementById("ingredientCategory-p").focus(),!1):isNaN(e.calories)||e.calories<=0?(alert("Please enter a valid number for calories (must be greater than 0)."),document.getElementById("ingredientCalories-p").focus(),!1):isNaN(e.protein)||e.protein<0?(alert("Please enter a valid number for protein (0 or more)."),document.getElementById("ingredientProtein-p").focus(),!1):isNaN(e.fats)||e.fats<0?(alert("Please enter a valid number for fat (0 or more)."),document.getElementById("ingredientFat-p").focus(),!1):isNaN(e.carbs)||e.carbs<0?(alert("Please enter a valid number for carbs (0 or more)."),document.getElementById("ingredientCarbs-p").focus(),!1):!e.uom||e.uom.trim()===""||e.uom==="Select Unit"?(alert("Please select a unit."),document.getElementById("ingredientUnit-p").focus(),!1):!0}async function us(){const e=document.getElementById("addIngredientSubmitBtn");e.disabled=!0;const t=document.getElementById("ingredientName-p").value.trim(),n=document.getElementById("ingredientCategory-p").textContent.trim(),s=document.getElementById("ingredientProtein-p").value.trim(),o=document.getElementById("ingredientFat-p").value.trim(),r=document.getElementById("ingredientCarbs-p").value.trim(),i=document.getElementById("ingredientCalories-p").value.trim(),a=document.getElementById("ingredientUnit-p").textContent.trim();let l=document.getElementById("ingredientUnit-p").textContent.trim();(a==="grams"||a==="milliliters")&&(l="100 ".concat(document.getElementById("ingredientUnit-p").textContent.trim()));const d={name:t,uom:l,calories:i,carbs:r,fats:o,protein:s,category:n};if(ds(d)){J(),S();const m=(await nn(d)).ingredientId;it(t,m,n),ms()}e.disabled=!1}function ms(){document.getElementById("ingredientName-p").value="",document.getElementById("ingredientProtein-p").value="",document.getElementById("ingredientFat-p").value="",document.getElementById("ingredientCarbs-p").value="",document.getElementById("ingredientCalories-p").value="",document.getElementById("ingredientCategory-p").textContent="fruits",document.getElementById("ingredientUnit-p").textContent="piece"}function ae(){const e=D(),t={user:"#1BCE86",cook:"#7F8DFF",admin:"#E35252"};switch(e.role){case"user":document.documentElement.style.setProperty("--accent-color",t.user);break;case"cook":document.documentElement.style.setProperty("--accent-color",t.cook);break;case"admin":document.documentElement.style.setProperty("--accent-color",t.admin);break;default:document.documentElement.style.setProperty("--accent-color",t.user)}}function fs(){const e=D(),t=document.getElementById("admin-panel");if(e&&e.role==="admin"){const n=document.querySelector("#home-container");n.style.gridTemplateRows="auto auto 1fr",t.classList.remove("hidden-admin-panel")}else t.classList.add("hidden-admin-panel")}function gs(){const e=D();e&&(e.role==="cook"||e.role==="admin")&&document.querySelectorAll(".add-item-p").forEach(n=>{n.style.display="flex"})}async function hs(){if(K("cook")||K("admin")){const e=document.getElementById("ingredients-list-p");e&&H(e,".ingredient-card-p",ps)}if(K("cook")||K("admin")){const e=document.querySelector("#dishes-list-p");e&&H(e,".dish-card-p",ys)}}async function ps(e){es(),await on(e)}async function ys(e){Qn(),await sn(e)}const me=new Map,vs=2;let ne=new Map;const ws=1;async function Es(e,t,n,s){const[o,r,i]=await Promise.all([$e("breakfast"),$e("main"),Qe()]);console.log("Dishes for breakfast:",o),console.log("Dishes for main:",r),console.warn("[algo.js] => Preferences loaded:",i);const a=Ls(e,0),l=[];for(let d=0;d<7;d++){const c=await bs(a,o,r,i),m=ks(c,a);l.push(m)}return console.log("Generated week plan:",l),l}function ks(e,t){return{breakfast:fe(e.breakfast,t[0]),lunch:fe(e.lunch,t[1]),dinner:fe(e.dinner,t[2]),puffer:null}}function fe(e,t){if(e.total_calories===t)return e;const[s,o]=at(e.total_calories,.2);if(s<=t&&t<=o){const r=t/e.total_calories;return ge(e,r)}if(t>o){const r=o/e.total_calories;return ge(e,r)}if(t<s){const r=s/e.total_calories;return ge(e,r)}return e}function ge(e,t){var o;const n=((o=e.ingredients)==null?void 0:o.map(r=>({...r,amount_scaled:(r.amount*t).toFixed(1)})))||[];return{dish_id:e.dish_id,name:e.name,preparation:e.preparation,vm_score:e.vm_score,meal_category:e.meal_category,preparation_time_in_min:e.preparation_time_in_min,total_calories:Math.round(e.total_calories*t),total_protein:Math.round(e.total_protein*t),total_fat:Math.round(e.total_fat*t),total_carbs:Math.round(e.total_carbs*t),tags:e.tags,ingredients:n,factor:t}}async function bs(e,t,n,s){console.log("DAY START"),ne=new Map;const o=e[0],r=e[1],i=e[2];e[3];const a={breakfast:null,lunch:null,dinner:null,puffer:null};return a.breakfast=await he(o,t,s),a.lunch=await he(r,n,s),Is(a.lunch),a.dinner=await he(i,n,s),a}function Is(e){if(e){const t=ne.get(e.dish_id)||0;ne.set(e.dish_id,t+1)}}function Ls(e,t){switch(t){case 0:return[e*.24,e*.38,e*.38];case 1:return[e*.2,e*.35,e*.35,e*.1];case 2:return[e*.17,e*.32,e*.32,e*.19];default:return[]}}async function he(e,t,n){for(let o=0;o<=.2;o=o+.05){const r=Bs(e,o),i=t.filter(a=>{const l=at(a.total_calories,.2);return Ds(l,r)});if(i.length>0)return await Cs(i,n)}return Ss(e)}function Ss(e){return console.warn("⚠️ Kein Gericht gefunden für kcal-Ziel ".concat(e)),{name:"Kein Gericht gefunden",preparation:"-",total_calories:0,total_protein:0,total_fat:0,total_carbs:0,vm_score:0,preparation_time_in_min:0}}async function Cs(e,t){if(e.length===1)return console.log("only one candidate found"),e[0];const n=new Set(t.preferredDishes||[]),s=new Set(t.preferredIngredients||[]),o=new Set(t.blockedDishes||[]),r=new Set(t.blockedIngredients||[]);function i(f){for(let y=f.length-1;y>0;y--){const x=Math.floor(Math.random()*(y+1));[f[y],f[x]]=[f[x],f[y]]}return f}const a=[],l=[],d=[],c=[],m=[],g=[];for(const f of e){const y=f.dish_id,x=me.get(y)||0;if((ne.get(y)||0)>=ws){c.push(f);continue}if(x>=vs){f._source="duplicates (global)",c.push(f);continue}n.has(y)?(f._source="preferredDishes",a.push(f)):Ge(f,s)?(f._source="preferredIngredients",l.push(f)):o.has(y)?(f._source="blockedDishes",g.push(f)):Ge(f,r)?(f._source="blockedIngredients",m.push(f)):(f._source="neutral",d.push(f))}const E=[...i(a),...i(l),...i(d),...i(c),...i(m),...i(g)],h=E[0];if(h){const f=me.get(h.dish_id)||0;me.set(h.dish_id,f+1)}return xs(E),h||null}function xs(e){const t=e.map(n=>({dish_id:n.dish_id,source:n._source||"unknown"}));console.warn("[Debug] Zusammengesetztes Kandidaten-Array:",t)}function Ge(e,t){return Array.isArray(e.ingredientIDs)?e.ingredientIDs.some(n=>t.has(n)):!1}function Bs(e,t){const n=e*t;return[e-n,e+n]}function at(e,t){const n=e*t;return[e-n,e+n]}function Ds(e,t){const[n,s]=e,[o,r]=t;return s>=o&&n<=r}async function _s(){j();const e=document.getElementById("app"),t=await T("./html-pages/plan.html");e.innerHTML=t;const{today:n,currentWeek:s}=dt();await Ts(n,s),Qs(n,s),re()}async function Ts(e,t){Ps(e,t);const n=await ct();await As(e,t,n),Be(n)}async function As(e,t,n){const s=await ht(t,n);yt(s,n)}async function ct(){let e=await rn();return(!e||e.length===0)&&(console.warn("Week plan not found in database. Generating a new one..."),e=await lt()),console.warn("Week plan loaded from DB:",e),e}async function lt(){let e=await gt();return console.log("Optimal daily Calories!: "+e),await Es(e)}function dt(){const e=new Date,t=qs(e);return{today:e,currentWeek:t}}function Ps(e,t){const n=e.getMonth(),s=e.getFullYear();Ms(["January","February","March","April","May","June","July","August","September","October","November","December"],n,s),$s(e,t)}function qs(e){const t=new Date(e),n=e.getDay(),s=n===0?6:n-1;t.setDate(e.getDate()-s);const o=[];for(let r=0;r<7;r++){const i=new Date(t);i.setDate(t.getDate()+r),o.push(i)}return o}function Ms(e,t,n){const s=document.getElementById("monthYear");s&&(s.innerHTML="".concat(e[t],"<br>").concat(n))}function $s(e,t){const n=document.getElementById("daysGrid");if(!n)return;n.innerHTML="";const s=e.getMonth();t.forEach(o=>{const r=document.createElement("div");r.className="day",r.textContent=o.getDate(),r.setAttribute("data-day",o.getDate()),o.toDateString()===e.toDateString()&&r.classList.add("selected"),o.getMonth()!==s&&r.classList.add("other-month"),n.appendChild(r)})}function Ve(e,t,n,s){return e==="male"?66.47+13.75*n+5*s-6.755*t:655.1+9.563*n+1.85*s-4.676*t}function Ke(e,t,n,s){const o=10*n+6.25*s-5*t;return e==="male"?o+5:o-161}function Os(e){const t=e.toLowerCase();return{"very low":1.2,low:1.375,moderate:1.55,active:1.725,"very active":1.9}[t]||1.55}const ut=-200,mt=0,ft=200;function Ns(e){const t=e.toLowerCase().trim();return{"losing weight":ut,"maintaining weight":mt,"gaining weight":ft}[t]||0}function Us(e,t,n,s,o,r){let i=0;switch(r){case ut:i=Ve(e,t,n,s);break;case mt:i=(Ke(e,t,n,s)+Ve(e,t,n,s))/2;break;case ft:i=Ke(e,t,n,s);break}const a=i*o;return Math.round(a+r)}async function gt(){let e=0;const{gender:t,age:n,weight_kg:s,weight_pounds:o,height_cm:r,height_feet_and_inches:i,activityLevel:a,goal:l}=await Ze();if(t&&n&&s&&r&&a&&l){const d=t.toLowerCase().trim(),c=n,m=s,g=r,E=Os(a),h=Ns(l);e=Us(d,c,m,g,E,h),console.log("Calculated optimal calories: "+e)}return e}async function ht(e,t){const n={};return e.forEach((s,o)=>{const r=s.getDate();n[r]=Fs(t[o])}),Je(t),n}function Fs(e){let t="";return t+=pe(e.breakfast,"Breakfast"),t+=pe(e.lunch,"Lunch"),t+=pe(e.dinner,"Dinner"),t}function pt(){const e=document.querySelector(".day.selected");return e?parseInt(e.getAttribute("data-day")):null}function pe(e,t){var n;return'\n    <div class="card drop-shadow plan-meal-card" data-id="'.concat(e.dish_id,'">\n        <div class="meal-header-mp">\n            <div>\n                <h3 class="meal-title-mp">').concat(e.name,'</h3>\n                <p class="subtext">').concat(t,'</p>\n            </div>\n            <div class="meal-calories-mp">').concat(e.total_calories,' kcal</div>\n        </div>\n        <div class="nutrition-values-mp">\n            <div class="nutrition-item-mp">\n                <p class="nutrition-value-mp">').concat(e.total_protein,'g</p>\n                <p class="nutrition-label-mp subtext">Protein</p>\n            </div>\n            <div class="nutrition-item-mp">\n                <p class="nutrition-value-mp">').concat(e.total_carbs,'g</p>\n                <p class="nutrition-label-mp subtext">Carbs</p>\n            </div>\n            <div class="nutrition-item-mp">\n                <p class="nutrition-value-mp">').concat(e.total_fat,'g</p>\n                <p class="nutrition-label-mp subtext">Fat</p>\n            </div>\n            <div class="nutrition-item-mp">\n                <p class="nutrition-value-mp">').concat(e.vm_score,'</p>\n                <p class="nutrition-label-mp subtext">VM score</p>\n            </div>\n        </div>\n        <div class="meal-details-mp">\n            <div class="footer-mp">\n                <img class="clock-logo-mp" src="./assets/icons/clock.svg" alt="clock">\n                <p class="footer-text-mp">').concat(e.preparation_time_in_min,'</p>\n            </div>\n            <div class="footer-mp">\n                <img class="users-logo-mp" src="./assets/icons/users.svg" alt="users">\n                <p class="footer-text-mp">').concat(((n=e.factor)!=null?n:1).toFixed(1)," serving</p>\n            </div>\n        </div>\n    </div>\n    ")}function we(e,t){const n=t[e]||"",s=document.getElementById("content-section");s&&(s.innerHTML=n)}function yt(e,t){document.querySelectorAll(".day").forEach(s=>{s.replaceWith(s.cloneNode(!0))}),document.querySelectorAll(".day").forEach(s=>{s.addEventListener("click",()=>{document.querySelectorAll(".day").forEach(r=>r.classList.remove("selected")),s.classList.add("selected");const o=parseInt(s.getAttribute("data-day"));we(o,e),Be(t)})});const n=pt();n&&we(n,e)}function Be(e){document.getElementById("viewDishOverlay").addEventListener("click",function(n){n.target===this&&(ye(),S(),ve(),F(0),U(0))}),document.getElementById("navOverlay").addEventListener("click",function(n){Hs()&&(ye(),S(),ve(),F(0),U(0))}),document.querySelector("#close-view-dish").addEventListener("click",function(n){ye(),S(),ve(),F(0),U(0)}),document.getElementById("reset-cooking-process").addEventListener("click",function(n){document.querySelectorAll("#view-dish-instructions-list .checkbox-overlay:checked").forEach(o=>{o.checked=!1}),F(0),U(0)}),document.querySelectorAll(".plan-meal-card").forEach(n=>{const s=n.dataset.id;n.addEventListener("click",()=>{js(),qe(),Vs(s,e),Rs()})})}function Hs(){return document.querySelector("#meal-plan")!=null}function Rs(){document.querySelectorAll(".checkbox-overlay").forEach(t=>{t.addEventListener("change",n=>{const s=document.querySelectorAll("#view-dish-instructions-list .checkbox-overlay:checked");F(s.length),U(s.length)})})}function U(e){let t="0%";if(e!==0){const o=vt();t=(e/o*100).toFixed(1)+"%"}const n=document.getElementById("cooking-progress-fill"),s=document.getElementById("view-%-steps");n.style.width=t,s.textContent=t}function js(){const e=document.getElementById("viewDishOverlay");e&&(e.classList.remove("hidden"),document.body.style.overflow="hidden")}function ye(){const e=document.getElementById("viewDishOverlay");e&&(e.classList.add("hidden"),document.body.style.overflow="auto")}function Ws(e,t){for(const n of t)for(const s of Object.values(n))if(s&&s.dish_id===Number(e))return s;return null}function Gs(e){const t=e.match(/(\d)([^0-9]+)/g),n={};return t&&t.forEach(s=>{const o=s.match(/^\d/)[0],r=s.slice(2).trim();n[o]=r}),n}function vt(){return document.getElementById("view-dish-instructions-list").querySelectorAll("li").length}function F(e){document.getElementById("view-completed-number").textContent=e}function ve(){const e=document.getElementById("view-dish-instructions-list"),t=document.getElementById("view-dish-ingredients-list");e.innerHTML="",t.innerHTML=""}function Vs(e,t){const n=Ws(e,t);Js(n),zs(n.ingredients);let s=Gs(n.preparation);Ys(s),Ks()}function Ks(){const e=vt();document.getElementById("view-total-number").textContent=e}function zs(e){const t=document.getElementById("view-dish-ingredients-list");for(const n in e){let s=Xs(e[n]);t.insertAdjacentHTML("beforeend",s)}}function Ys(e){const t=document.getElementById("view-dish-instructions-list");Object.entries(e).forEach(([n,s])=>{const o=Zs(n,s);t.insertAdjacentHTML("beforeend",o)})}function Js(e){document.getElementById("view-dish-name").textContent=e.name,document.getElementById("view-kcal").textContent=e.total_calories,document.getElementById("view-prep-time").textContent=e.preparation_time_in_min,document.getElementById("view-protein-amount").textContent=e.total_protein+"g",document.getElementById("view-carbs-amount").textContent=e.total_carbs+"g",document.getElementById("view-fat-amount").textContent=e.total_fat+"g",document.getElementById("view-vm-score").textContent=e.vm_score}function Xs(e){return'\n    <li class="view-dish-ingredient-el">\n        <p class="view-dish-ingredient-name">'.concat(e.name,'</p>\n        <p class="subtext view-dish-ingredient-amount">').concat(e.amount_scaled," ").concat(e.unit_of_measurement,"</p>\n    </li>\n    ")}function Zs(e,t){return'\n    <li class="view-instruction-step-el">\n        <input type="checkbox" class="checkbox-overlay">\n        <div class="view-instruction-text-container">\n            <p class="view-instruction-header">Step '.concat(e,'</p>\n            <p class="view-instruction-text">').concat(t,"</p>\n        </div>\n    </li>\n    ")}function Qs(e,t){const n=document.querySelector("#regenerate-plan");n&&n.addEventListener("click",async()=>{const s=pt(),o=await lt(),r=await ht(t,o);await hn();let i=await It(o);i=await St(i),await oe(i),yt(r,o),s&&we(s,r),Be(o)})}function eo(){const e=localStorage.getItem("soundEnabled");return e===null?!0:e==="true"}function to(e,t){if(!eo())return;const n=new Audio("./assets/sounds/".concat(t));n.volume=e,n.play()}function Ee(){to(.2,"checkbox.mp3")}async function wt(){j();const e=document.getElementById("app"),t=await T("./html-pages/home.html");e.innerHTML=t,fs(),ae(),setTimeout(()=>{bt()},1),await Et(),re()}function no(){document.querySelectorAll(".tab").forEach(e=>{e.addEventListener("click",async function(){document.querySelectorAll(".tab").forEach(t=>{t.classList.remove("active")}),this.classList.add("active"),await Et()})})}function so(){const e=document.getElementById("checked-circle");e&&e.addEventListener("change",async()=>{Ee(),await oo(100);let t=await _e(),n="breakfast";[t,n]=await fo(t);let s=go(t,n);await De(t),setTimeout(()=>{ke(s,n),e.checked=!1},300)})}async function oo(e){return new Promise(t=>setTimeout(t,e))}async function Et(){const e=document.querySelector(".tab.active"),t=document.getElementById("admin-container");if(e&&e.textContent.trim()==="Standard"&&t){const n=await T("./html-pages/homeStandard.html");t.innerHTML=n;let s=await _e();await oe(s),kt(s),yo(s),await De(s),no()}else{const n=await T("./html-pages/homeRoles.html");t.innerHTML=n,await xt()}}function kt(e){const t=Object.keys(e);for(let n=0;n<t.length;n++){const s=t[n],o=e[s];if(o&&!o.eaten){ke(o,s);return}}ke(null)}function bt(){const e=D(),t=document.getElementById("greeting-container");t&&(t.innerHTML='\n        <div id="greeting-text">\n            <span class="roboto">Hi,</span>\n            <span class="roboto">'.concat(e.username,'</span>\n        </div>\n        <div id="card-um').concat(_(e.role),'" class="tag">\n            <img class="tag-logo" src="./assets/icons/userRoleIcon').concat(_(e.role),'.svg" alt="tag">\n            <span id="text-um').concat(_(e.role),'" class="tag-text">').concat(Ct(e.role),"</span>\n        </div>\n        "))}function ro(e,t){for(let n=0;n<t.length;n++)if(t[n].getTime()===e.getTime())return n}async function It(e=null){const{today:t,currentWeek:n}=dt(),s=ro(t,n);return e||(e=await ct(),Je(e)),e[s]}function io(e){let t=0;const n=Object.keys(e);for(let s=0;s<n.length-1;s++){const o=n[s];e[o].eaten&&(t+=e[o].total_calories)}return t}function ao(e){return Object.values(e).filter(n=>n!=null).length}async function Lt(e,t){let n=e/t*100;return n>100?100:n}async function De(e){let t=await gt(),n=io(e);console.log("Eaten Kcal:",n),console.log("Optimal Kcal:",t),lo(n),await co(n,t),uo(e),mo(n,t),ho(e)}async function co(e,t){const n=document.querySelector(".progress-bar");if(n){let s=await Lt(e,t);n.style.setProperty("--progress-in-percent",s)}}function lo(e){const t=document.querySelector(".progress-text");t&&(t.textContent="".concat(e," kcal"))}async function uo(e){const t=ao(e),n=document.getElementById("planned-meals-h");t&&n&&(n.textContent=t)}async function mo(e,t){const n=await Lt(e,t),s=document.getElementById("goal-percentage-h");s&&(s.textContent="".concat(Math.round(n),"%"))}async function _e(e=!1){let t=await dn();if(!t||Object.keys(t).length===0||e){let n=await It();t=St(n),console.log("First meals save:",t)}return t}function St(e,t=!1){return Object.keys(e).forEach(n=>{e[n]&&(e[n].eaten=t)}),e}async function fo(e){const t=Object.keys(e);for(let n=0;n<t.length-1;n++){const s=t[n];if(!e[s].eaten){const o=t[n+1];return e[s].eaten=!0,await oe(e),[e,o]}}return[null,null]}function go(e,t){return e[t]||null}function ho(e){const t=document.getElementById("todays-meals-container");if(t){const n=Object.keys(e);for(let s=0;s<n.length-1;s++){const o=n[s];for(const r of t.children){let i=r.querySelector(".item-id").textContent;s===Number(i)&&(e[o].eaten?r.querySelector(".check-point-db").classList.add("active"):r.querySelector(".check-point-db").classList.remove("active"))}}}}function po(e){return e.charAt(0).toUpperCase()+e.slice(1)}function ke(e,t){if(!e){wo();return}const n=document.querySelector(".congratulations-message-db");n&&n.remove();const s=document.querySelector(".next-meal-container");s&&(s.innerHTML='   <div class="card drop-shadow next-meal-card-db">\n                <div class="first-row-db">\n                    <input id="checked-circle" class="checkbox" type="checkbox">\n\n                    <div class="next-meal-info">\n                        <div class="next-meal-info-texts">\n                            <h3 class="meal-name-db">'.concat(e.name,'</h3>\n                            <span class="subtext meal-category-h">').concat(po(t),'</span>\n                        </div>\n\n                        <span class="calories-db">\n                        ').concat(e.total_calories,' kcal\n                        </span>\n                    </div>\n                </div>\n\n                <div class="nutrition-values-db">\n                    <div class="nutrition-item-db">\n                        <p class="nutrition-value-db">').concat(e.total_protein,'</p>\n                        <p class="nutrition-label-db subtext">Protein</p>\n                    </div>\n                    <div class="nutrition-item-db">\n                        <p class="nutrition-value-db">').concat(e.total_carbs,'</p>\n                        <p class="nutrition-label-db subtext">Carbs</p>\n                    </div>\n                    <div class="nutrition-item-db">\n                        <p class="nutrition-value-db">').concat(e.total_fat,'</p>\n                        <p class="nutrition-label-db subtext">Fat</p>\n                    </div>\n                </div>\n            </div>\n        ')),so()}function yo(e){const t=document.getElementById("todays-meals-container");if(t&&t.children.length===0){const n=Object.keys(e);for(let s=0;s<n.length-1;s++){const o=n[s];t.appendChild(vo(s,e,o))}}}function vo(e,t,n){let s=t[n];const o=document.createElement("li");return o.className="card drop-shadow mealcards-db",o.innerHTML='<div class="check-point-db"></div>\n                    <div class="todays-meal-info">\n                        <span class="item-id">'.concat(e,'</span>\n                        <h3 class="meal-name-db">').concat(s.name,'</h3>\n                        <span class="subtext">').concat(n,'</span>\n                    </div>\n                    <h3 class="todays-calories">').concat(s.total_calories," kcal</h3>"),o}function wo(){const e=document.querySelector(".next-meal-container");document.querySelector(".congratulations-message-db")||(e.innerHTML='\n        <div class="congratulations-message-db">     \n            <span> Congratulations! 🎉</span>\n            <span>You have achieved your goal!</span> \n            <button id="congrats-link">reset</button>\n        </div>\n        ',Eo())}function Eo(){document.getElementById("congrats-link").addEventListener("click",async()=>{let e=await _e(!0);await oe(e),kt(e),await De(e)})}function _(e){if(e==="user")return 1;if(e==="cook")return 2;if(e==="admin")return 3}function Ct(e){if(e==="user")return"User";if(e==="cook")return"Chef";if(e==="admin")return"Admin"}function ko(e){if(e==="User")return"user";if(e==="Chef")return"cook";if(e==="Admin")return"admin"}function bo(e){return e.split(" ").map(t=>t[0].toUpperCase()).join("").slice(0,2)}async function xt(){const e=document.getElementById("user-list");e.innerHTML="",(await Yt()).forEach(r=>{const i=bo(r.username),a=document.createElement("li");a.classList.add("card","user"),a.innerHTML='\n        <div class="swipe-delete">Delete</div>\n        <div class="swipe-content">\n            <span class="item-id">'.concat(r.user_id,'</span>\n            <div class="profile-picture">\n                <span>').concat(i,'</span>\n            </div>\n            <div class="user-data">\n                <span class="user-name">').concat(r.username,'</span>\n                <span class="user-email">').concat(r.email,'</span>\n            </div>\n            <div id="user-role">\n                <div class="user-tag" id="card-um').concat(_(r.role),'">\n                    <img class="user-tag-logo" src="./assets/icons/userRoleIcon').concat(_(r.role),'.svg" alt="tag">\n                    <span id="text-um').concat(_(r.role),'" class="user-tag-text">').concat(Ct(r.role),'</span>\n                </div>\n                <object id="change-role" src="./assets/icons/change-role.svg" alt="change role"></object>\n            </div>\n        </div>\n        '),e.appendChild(a)}),Bt(),e&&H(e,".card.user",Io),document.querySelectorAll("#change-role").forEach(r=>{r.addEventListener("click",So)}),Q("user-search-bar",["#user-list"])}async function Io(e){en(e),setTimeout(()=>{},2e3),console.warn("TOTAL USERS ARE BEING RENDERED AGAIN"),Bt()}function Lo(e,t,n){if(e==="admin"){const s=D();if(s.email===n)throw alert("You cannot change your own role."),new Error("Admin role change denied for self.");if(s.name!=="admin"&&s.email!=="admin@admin.com")throw alert("You cannot change the role of an admin."),new Error("Admin role change denied for super user.")}}async function So(e){const t=e.target.closest(".user"),n=t.querySelector(".user-name").textContent,s=t.querySelector(".user-email").textContent,o=t.querySelector(".user-tag-text").textContent,r=ko(o);Lo(r,n,s);const i=_(r)%3,l=["user","cook","admin"][i];await Qt(l,s),xt(),bt()}function Co(){const e=document.getElementById("user-list");return e?e.querySelectorAll("li").length:0}function Bt(){const e=document.getElementById("total-users-amount");e&&(e.textContent=Co())}const Y=new Map;async function xo(){j();const e=document.getElementById("app"),t=await T("./html-pages/list.html");e.innerHTML=t,Bo();const n=await Do();_o(n),Dt(),R(),Ao();const s=document.querySelector(".grocery-list");H(s,".grocery-item",_t)}function Bo(){re(),document.querySelectorAll("#filter-bar button").forEach(t=>{t.addEventListener("click",()=>{Qo(t)})}),document.getElementById("add-item-btn").addEventListener("click",()=>{document.getElementById("newItem")||Go("grocery-item drop-shadow addingContainer")})}function Dt(){document.querySelector(".grocery-list").addEventListener("click",Yo)}async function Do(){let e=await mn();return e&&e.length>0?console.warn("Lade User List Items aus DB:",e):(console.warn("Keine User List Items gefunden – lade aus WeekPlan ..."),e=await an(),console.log("Ingredients from week plan:",e),await un(e)),e}function _o(e){e.forEach(t=>Tt(t))}function R(){const e=document.querySelectorAll(".grocery-list li"),t=To(e),n=e.length,s=document.getElementById("checked-count-gl"),o=document.getElementById("total-count-gl");s&&o?(s.textContent="".concat(t.length),o.textContent="".concat(n)):console.warn("Checked count or total count element not found!")}function To(e){return Array.from(e).filter(t=>t.querySelector(".checkbox-gl").checked)}function Ao(){Q("search-groceries",[".grocery-list"])}function _t(e){console.log("Deleting item with identifier:",e),gn(e),R()}function Tt(e){const t=document.querySelector(".grocery-list"),n=document.createElement("li");n.className="grocery-item drop-shadow",n.innerHTML=At(e),Te(n,e),ce(n,e),e.is_checked&&Pt(n),t.firstChild?t.insertBefore(n,t.firstChild):t.appendChild(n)}function At(e){const t=Ae(e),n=e.is_checked?"checked":"";return'\n        <div class="swipe-delete">Delete</div>\n        <div class="swipe-content">\n            <span class="item-id">'.concat(t,'</span>\n            <input class="checkbox checkbox-gl" type="checkbox" ').concat(n,' />\n            <div class="item-details">\n                <h3>').concat(e.name,'</h3>\n                <span class="category subtext">').concat(e.category,'</span>\n            </div>\n            <div class="quantity-control">\n                <button class="minus-btn"><img src="./assets/icons/minus.svg" alt="-"></button>\n                <span class="amount">').concat(Math.round(e.amount),'</span>\n                <span class="unit">').concat(qt(e.unit_of_measurement),'</span>\n                <button class="plus-btn"><img src="./assets/icons/plus.svg" alt="+"></button>\n            </div>\n        </div>\n    ')}function ce(e,t){t.is_checked||e.querySelector(".item-details").addEventListener("click",()=>{qo(e,t)})}function Po(e,t){const n=e.querySelector(".item-details");if(n){const s=n.cloneNode(!0);n.parentNode.replaceChild(s,n)}}function qo(e,t){if(!Ht()){const n=e.cloneNode(!0),s=Ot();Mo(e),e.innerHTML=s,$t(),$o(e,t);const o=e.querySelector(".save-btn"),r=e.querySelector(".cancel-btn");o.addEventListener("click",()=>{Oo(e,n,t)}),r.addEventListener("click",()=>{e.replaceWith(n),Te(n,t),ce(n,t),R()})}}function Mo(e){e.id="newItem";const t="grocery-item drop-shadow addingContainer";e.className=t}function $o(e,t){const n=e.querySelector("#new-item-container");n.querySelector('input[type="text"]').value=t.name||"",n.querySelector('input[type="number"]').value=Math.round(t.amount)||"";const s=n.querySelectorAll(".custom-select");s[0].querySelector(".select-text").textContent=t.category||"Protein",s[1].querySelector(".select-text").textContent=qt(t.unit_of_measurement)||"g"}function Oo(e,t,n){const s=Ut();if(!Nt(s))return;const o={...s.item,is_checked:0};Le(Ae(n),o),No(e,t,o)}function No(e,t,n){Uo(e,t),e.innerHTML=At(n),ce(e,n),Te(e,n),Dt(),H(e,".grocery-item",_t)}function Uo(e,t){e.id=t.id||"",e.className=t.className||"grocery-item drop-shadow"}function Fo(e,t,n,s){return e.dataset.locked==="true"?(n.preventDefault(),t.checked=!0,!0):(e.dataset.locked="true",setTimeout(()=>{delete e.dataset.locked},s),!1)}function Ho(e){delete e.dataset.locked}async function Te(e,t){const n=e.querySelector(".checkbox-gl");n.addEventListener("change",s=>Ro(s,e,t,n))}async function Ro(e,t,n,s){if(Fo(t,s,e,600))return;const r={ingredient_id:n.ingredient_id||null,custom_name:n.name||null,category:n.category||null,amount:n.amount,unit_of_measurement:n.unit_of_measurement,is_checked:s.checked?1:0};R(),await jo(t,r.is_checked,600,n),await Le(Ae(n),r),Ho(t)}async function jo(e,t,n,s){const o=document.querySelector(".grocery-list");t?(Po(e),Pt(e),Ee(),await new Promise(r=>setTimeout(r,n)),o.appendChild(e)):(ce(e,s),Wo(e),Ee(),o.insertBefore(e,o.firstChild))}function Pt(e){const t=e.querySelector(".quantity-control");t&&(t.style.display="none")}function Wo(e){const t=e.querySelector(".quantity-control");t&&(t.style.display="flex")}function Ae(e){if(e.ingredient_id!==null&&e.ingredient_id!==void 0)return e.ingredient_id;if(e.name)return e.name;console.error("Item has no valid identifier")}function qt(e){return e==="piece"?"pcs":e}function Mt(e){return e==="pcs"?"piece":e}function $t(){newItem.querySelectorAll(".custom-select").forEach(t=>{new Z(t)})}function Go(e="grocery-item drop-shadow"){const t=document.querySelector(".grocery-list"),n=document.createElement("li");n.id="newItem",n.className=e,n.innerHTML=Ot(),t.insertBefore(n,t.firstChild),$t();const s=n.querySelector(".save-btn"),o=n.querySelector(".cancel-btn");s.addEventListener("click",Vo),o.addEventListener("click",Ft)}function Ot(){return'\n    <div id="new-item-container">\n        <div class="item-details-add">\n            <input id="name-gl" type="text" placeholder="Item Name" />\n            <div class="custom-select">\n                <div class="select-trigger">\n                    <span class="select-text">Protein</span>\n                    <div class="select-arrow"></div>\n                </div>\n                <div class="select-dropdown">\n                    <div class="select-option" data-value="Protein">Protein</div>\n                    <div class="select-option" data-value="Fruit">Fruit</div>\n                    <div class="select-option" data-value="Dairy">Dairy</div>\n                </div>\n            </div>\n        </div>\n        <div class="quantity-control-add">\n            <input id="number-gl" type="number" placeholder="100" />\n            <div class="custom-select unit-gl">\n                <div class="select-trigger">\n                    <span class="select-text">Select Unit</span>\n                    <div class="select-arrow"></div>\n                </div>\n                <div class="select-dropdown">\n                    <div class="select-option" data-value="g">g</div>\n                    <div class="select-option" data-value="pcs">pcs</div>\n                    <div class="select-option" data-value="ml">ml</div>\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class="buttons-container">\n        <button class="cancel-btn">Cancel</button>\n        <button class="save-btn">Save</button>\n    </div>\n    '}function Vo(){const e=Ut();if(!Nt(e))return;Tt(e.item);const t=zo(e.item);fn(t),Ft(),R()}function Nt(e){return e.allFieldsFilled?e.isValidName?e.isUniqueName?!0:(alert("An item with this name already exists."),!1):(alert("Please enter a valid name!\n(Name must not be empty, only numbers, or start with a number)"),!1):(alert("Please fill out all fields!"),!1)}function Ut(){const e=document.getElementById("new-item-container"),t=e.querySelector('input[type="text"]').value.trim(),n=parseInt(e.querySelector('input[type="number"]').value,10),s=e.querySelectorAll(".custom-select"),o=s[0].querySelector(".select-text").textContent,r=s[1].querySelector(".select-text").textContent,i=o,a=Mt(r),l=t.length>0&&!/^\d+$/.test(t)&&!/^\d/.test(t),d=!!(t&&n&&i&&a),c=Ko();return{allFieldsFilled:d,isValidName:l,isUniqueName:c,name:t,amount:n,category:i,unit:a,item:{ingredient_id:null,name:t,custom_name:t,category:i,amount:n,unit_of_measurement:a,is_checked:0}}}function Ko(){return!0}function zo(e){return{custom_name:e.name,category:e.category,amount:e.amount,unit_of_measurement:e.unit_of_measurement}}function Ft(){const e=document.getElementById("newItem");e&&e.remove()}function Yo(e){if(e.target.closest(".swipe-delete"))return;const t=e.target.closest("button");if(!t||!t.closest(".quantity-control"))return;e.preventDefault();const n=t.closest(".swipe-content"),s=n.querySelector(".amount");if(!s)return;let o=parseInt(s.textContent,10);t.classList.contains("plus-btn")?s.textContent=o+1:t.classList.contains("minus-btn")&&o>1&&(s.textContent=o-1);const r=n.querySelector(".item-id").textContent;console.warn("IDENTIFIER: "+r);const i=Jo(n,r),a=Xo(r);Zo(a,r,i)}function Jo(e,t){return{ingredient_id:isNaN(t)?null:t,custom_name:isNaN(t)?t:null,category:e.querySelector(".category").textContent,amount:parseInt(e.querySelector(".amount").textContent,10),unit_of_measurement:Mt(e.querySelector(".unit").textContent),is_checked:e.querySelector(".checkbox-gl").checked?1:0}}function Xo(e){return typeof e=="number"?"id_".concat(e):"name_".concat(e)}function Zo(e,t,n){Y.has(e)&&clearTimeout(Y.get(e));const s=setTimeout(()=>{Le(t,n),Y.delete(e)},1e3);Y.set(e,s)}function Qo(e){document.querySelectorAll("#filter-bar button").forEach(n=>{n===e?(er(e),n.classList.add("active"),n.classList.remove("notActive")):(n.classList.remove("active"),n.classList.add("notActive"))})}function Ht(){return document.getElementById("newItem")!==null}function er(e){const t=e.textContent.trim(),n=Ht();document.querySelectorAll(".grocery-list li").forEach((s,o)=>{if(o===0&&n){s.style.display="";return}const r=s.querySelector(".category").textContent.trim();s.style.display=t==="All"||r.includes(t)?"":"none"})}async function tr(){await Wt(["admin","cook","user"]),await Me()?console.log("[TokenCheck] ✅ Alles in Ordnung11111111111111"):console.warn("[TokenCheck] ❌ Tokenprüfung fehlgeschlagen – Nutzer wird ausgeloggt11111111111"),setInterval(async()=>{console.log("[TokenCheck] 🔄 Starte regelmäßige Prüfung..."),await Me()?console.log("[TokenCheck] ✅ Alles in Ordnung"):console.warn("[TokenCheck] ❌ Tokenprüfung fehlgeschlagen – Nutzer wird ausgeloggt")},300*1e3),ln();async function t(){const o=await Jt();console.log("Daten aus storage.js:",o)}await t(),console.log("--------------DATA LOADED FROM DBBBBB-------------"),(await Ie()).forEach(o=>{console.log("Dish Name: ".concat(o.name))}),console.log("--------------DATA LOADED FROM LS LS LS-------------");const s=Xt();s.ingredients,console.log(s),s.dishes.forEach(o=>{console.log("Dish Name: ".concat(o.name))}),sr()}tr();const nr={home:wt,list:xo,plan:_s,meals:Fn,settings:yn};function sr(){ae(),Se(),Pe()}let Rt=localStorage.getItem("lastValidHash")||"#home";function or(){const e=window.location.hash;e!=="#settings"&&(Rt=e,localStorage.setItem("lastValidHash",e))}function rr(){return localStorage.getItem("lastValidHash")||Rt||"#home"}function ir(){const e=document.querySelectorAll("#main-nav a");function t(){const n=window.location.hash;e.forEach(s=>{s.getAttribute("href")===n?s.classList.add("active"):s.classList.remove("active")})}t(),window.addEventListener("hashchange",t)}async function Pe(){(!window.location.hash||window.location.hash==="")&&window.history.replaceState(null,null,"#home");const e=window.location.hash.slice(1),t=wt;await(nr[e]||t)(),ir(),e!=="settings"&&j(),or(),console.log("Page loaded:",e||"home")}window.addEventListener("hashchange",Pe);window.addEventListener("load",Pe);function j(){const e=document.getElementById("main-nav");e&&(e.classList.add("showNav"),e.classList.remove("hiddenNav"))}function S(){document.getElementById("navOverlay").classList.add("hidden")}function qe(){document.getElementById("navOverlay").classList.remove("hidden")}export{He as I,Re as N,tt as W,ar as __vite_legacy_guard};
